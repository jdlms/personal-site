import { useState } from "react";

export function Button() {
  const [clicked, setClicked] = useState(false);
  const [waveNumber, setWaveNumber] = useState(null);

  const handleClick = async () => {
    if (clicked) return; 
    setClicked(true); 

    const storedWaveNumber = localStorage.getItem('waveNumber');
    if (storedWaveNumber) {
      setWaveNumber(parseInt(storedWaveNumber, 10));
    } else {
      try {
        const response = await fetch('/api/updateWaves', {
          method: 'PUT',
        });

        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.statusText}`);
        }

        const { waveCount } = await response.json();

        if (waveCount !== undefined) {
          setWaveNumber(waveCount);
          localStorage.setItem('waveNumber', waveCount);
        }
      } catch (error) {
        console.error("There was an error:", error);
        setClicked(false);
      }
    }
  };

  return (
    <button
      type="button"
      id="dynamicButton"
      className="bg-my-background border cursor-pointer border-my-accent flex justify-center items-center text-my-gray font-semibold focus:outline-none focus:ring-2 focus:ring-gray-700 hover:border-my-sundown-orange rounded-lg text-xs md:text-sm px-4 py-1 mb-2 w-28 h-10 md:space-x-2"
      onClick={handleClick}
    >
      <svg
        width="35pt"
        height="35pt"
        version="1.1"
        viewBox="0 0 100 100"
        xmlns="http://www.w3.org/2000/svg"
        fill="#F5F5DC"
        className="ml-[-4px]"
      >
       <g>
            <path d="m38.211 52.117c0.10156-0.65625 0.40234-1.2578 0.90625-1.7148 0.35156-0.35156 0.70703-0.55469 1.1602-0.75391l-0.75391-0.75391c-1.2578-1.2578-1.2578-3.3242 0-4.5859 0.35156-0.35156 0.75391-0.60547 1.2578-0.75391-0.45312-0.75391-0.55469-1.6641-0.30078-2.5195v-0.10156c0.10156-0.20312 0.35156-0.90625 1.0078-1.4609 0.55469-0.45312 1.2578-0.70703 2.0156-0.70703 0.60547 0 1.1602 0.15234 1.6641 0.45312 0.15234-0.45312 0.40234-0.90625 0.75391-1.2578 0.60547-0.60547 1.4102-0.95703 2.2656-0.95703s1.6641 0.35156 2.2656 0.95703l6.6523 6.4961c0-0.050781-0.050781-0.10156-0.050781-0.15234-0.50391-1.2109-0.25-2.5703 0.70703-3.5273 0.30078-0.30078 0.65625-0.55469 1.0586-0.70703 0.40234-0.15234 0.80469-0.25 1.2578-0.25 0.40234 0 0.85547 0.10156 1.2109 0.25 0.80469 0.35156 1.4102 0.95703 1.7617 1.7617l4.6836 11.285v0.10156c1.4102 4.1367 0.40234 8.5703-2.6719 11.645-2.1172 2.1172-4.9883 3.3242-8.0117 3.3242-3.0234 0-5.8438-1.1602-8.0117-3.3242l-9.9766-9.9766c-0.64844-0.70703-1.0039-1.7617-0.85156-2.7695zm2.2656 1.4609 9.2227 9.2695 0.70703 0.70703c1.8125 1.8125 4.2305 2.7695 6.6484 2.7695 2.418 0 4.8359-0.90625 6.6484-2.7695 2.5703-2.5703 3.4258-6.2969 2.2656-9.7227l-4.6836-11.285c-0.15234-0.35156-0.40234-0.60547-0.70703-0.70703-0.15234-0.050782-0.35156-0.10156-0.50391-0.10156-0.15234 0-0.35156 0.050781-0.50391 0.10156-0.15234 0.050781-0.30078 0.15234-0.45312 0.30078-0.40234 0.40234-0.50391 0.95703-0.30078 1.4609 0 0 2.418 5.9961 2.6719 6.6016 0.15234 0.40234 0 0.75391-0.30078 0.75391-0.15234 0-0.30078-0.10156-0.50391-0.30078-0.60547-0.60547-2.7695-2.7695-2.7695-2.7695l-8.7188-8.7188c-0.25-0.25-0.60547-0.40234-0.95703-0.40234-0.35156 0-0.70703 0.15234-0.95703 0.40234-0.50391 0.50391-0.50391 1.3594 0 1.9141l8.5117 8.5117c0.35156 0.35156 0.35156 0.95703 0 1.3086-0.20312 0.20312-0.40234 0.25-0.65625 0.25-0.15234 0-0.35156-0.050782-0.50391-0.15234-0.050781-0.050781-0.10156-0.10156-0.15234-0.15234l-10.023-9.918c-0.25-0.25-0.60547-0.40234-0.95703-0.40234-0.30078 0-0.60547 0.10156-0.85547 0.30078-0.25 0.20312-0.35156 0.45312-0.45312 0.65625-0.15234 0.45312 0 0.95703 0.35156 1.3086l10.027 10.027c0.20313 0.20313 0.30078 0.50391 0.25 0.75391 0 0.20312-0.10156 0.40234-0.25 0.55469-0.20312 0.20312-0.40234 0.25-0.65625 0.25h-0.10156c-0.20312 0-0.40234-0.10156-0.60547-0.25l-8.4648-8.4648c-0.25-0.25-0.60547-0.40234-0.95703-0.40234-0.35156 0-0.70703 0.15234-0.95703 0.40234-0.50391 0.50391-0.50391 1.3594 0 1.9141l8.0625 8.0156 0.30078 0.30078 1.3125 1.3086c0.35156 0.35156 0.35156 0.95703 0 1.3086-0.20312 0.20312-0.40234 0.25-0.65625 0.25-0.25 0-0.50391-0.10156-0.65625-0.25l-6.8516-6.8516c-0.25-0.25-0.60547-0.40234-0.95703-0.40234-0.35156 0-0.70703 0.15234-0.95703 0.40234-0.20312 0.20312-0.30078 0.45312-0.35156 0.70703-0.050781 0.45312 0.050781 0.90625 0.40234 1.2109z"></path>
            <path d="m31.207 48.59c0.30078 0 0.50391 0.20312 0.50391 0.50391 0 4.2812 1.6641 8.3125 4.6836 11.336 0.20312 0.20312 0.20312 0.50391 0 0.70703-0.10156 0.10156-0.25 0.15234-0.35156 0.15234-0.10156 0-0.25-0.050781-0.35156-0.15234-3.2227-3.2227-4.9883-7.5078-4.9883-12.043 0-0.30469 0.25391-0.50391 0.50391-0.50391z"></path>
            <path d="m34.078 48.59c0.30078 0 0.50391 0.20312 0.50391 0.50391 0 3.5781 1.3594 6.9531 3.8281 9.5234 0.20312 0.20312 0.20312 0.50391 0 0.70703-0.10156 0.10156-0.20312 0.15234-0.35156 0.15234-0.15234 0-0.25-0.050781-0.35156-0.15234-2.6719-2.7695-4.1328-6.3984-4.1328-10.227 0-0.30859 0.25391-0.50781 0.50391-0.50781z"></path>
            <path d="m59.371 36.75c-0.15234 0-0.25-0.050781-0.35156-0.15234-3.0234-3.0234-7.0547-4.6836-11.336-4.6836-0.30078 0-0.50391-0.20312-0.50391-0.50391 0-0.30078 0.25-0.50391 0.50391-0.50391 4.5352 0 8.8164 1.7617 12.043 4.9883 0.20313 0.20312 0.20313 0.50391 0 0.70703-0.10547 0.097657-0.25391 0.14844-0.35547 0.14844z"></path>
            <path d="m47.684 33.625c3.7773 0.10156 7.3555 1.6641 10.027 4.332 0.20312 0.20312 0.20312 0.50391 0 0.70703-0.10156 0.10156-0.25 0.15234-0.35156 0.15234s-0.25-0.050781-0.35156-0.15234c-2.4688-2.4688-5.793-3.9297-9.3203-4.0312-0.30078 0-0.50391-0.25-0.50391-0.50391-0.054688-0.30078 0.19531-0.55469 0.5-0.50391z"></path>
        </g>  
      </svg>
      {clicked && waveNumber !== null ? (
        <span className="m-0 p-0">#{waveNumber}</span>
      ) : (
        <span className="m-0 p-0">Wave</span>
      )}
    </button>
  );
}

